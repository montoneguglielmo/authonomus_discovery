"""
Mathematical transform utilities.
"""

import math
import numpy as np


def quat2axisangle(quat):
    """
    Convert quaternion [x, y, z, w] to 3D axis-angle representation.
    """
    if quat[3] > 1.0:
        quat[3] = 1.0
    elif quat[3] < -1.0:
        quat[3] = -1.0
    den = np.sqrt(1.0 - quat[3] * quat[3])
    if math.isclose(den, 0.0):
        return np.zeros(3)
    return (quat[:3] * 2.0 * math.acos(quat[3])) / den
